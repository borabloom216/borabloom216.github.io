<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§ˆì¼€íŒ… ëŒ€ì‹œë³´ë“œ</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // ê°„ë‹¨í•œ SVG ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
    const IconDashboard = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>;
    const IconWallet = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a8 8 0 0 1-5.45 7.49 2 2 0 0 1-2.31-1.12l-1.56-3.48a2 2 0 0 0-1.82-1.18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h15Z"/></svg>;
    const IconTrending = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
    const IconTarget = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;
    const IconSparkles = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>;

    const App = () => {
      const [rawData, setRawData] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [selectedCategory, setSelectedCategory] = useState('ì „ì²´');
      const [aiAnalysis, setAiAnalysis] = useState(null);
      const [isGenerating, setIsGenerating] = useState(false);

      // ì¹´í…Œê³ ë¦¬ë³„ ëª©í‘œ KPI ì˜ˆì‚° ì„¤ì • (ì½”ë“œì—ì„œ ì‰½ê²Œ ìˆ˜ì • ê°€ëŠ¥)
      const config = {
        'TV': { targetROAS: 1000, targetCVR: 1.2, budget: 15000000 },
        'ì—ì–´ì»¨': { targetROAS: 800, targetCVR: 2.5, budget: 20000000 },
        'ëƒ‰ì¥ê³ ': { targetROAS: 600, targetCVR: 2.2, budget: 10000000 },
      };

      // ìˆ«ì/í¼ì„¼íŠ¸/ì½¤ë§ˆ ë°ì´í„° ì •ì œ í•¨ìˆ˜
      const cleanNumber = (val) => {
        if (!val) return 0;
        return Number(val.toString().replace(/,/g, '').replace(/%/g, '').trim());
      };

      // CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
      useEffect(() => {
        Papa.parse('data.csv', {
          download: true,
          header: true,
          skipEmptyLines: true,
          complete: (results) => {
            const parsed = results.data.map((row, idx) => ({
              id: idx,
              category: row['category'] || 'ë¯¸ë¶„ë¥˜',
              spend: cleanNumber(row['Ad spend']),
              revenue: cleanNumber(row['Revenue']),
              cvr: cleanNumber(row['CVR']),
              ctr: cleanNumber(row['CTR']),
              roas: cleanNumber(row['ROAS'])
            }));
            setRawData(parsed);
            setIsLoading(false);
          },
          error: (err) => {
            console.error("CSV ë¡œë“œ ì‹¤íŒ¨:", err);
            setIsLoading(false);
          }
        });
      }, []);

      // ë™ì  ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
      const categories = useMemo(() => {
        const cats = [...new Set(rawData.map(d => d.category))];
        return ['ì „ì²´', ...cats];
      }, [rawData]);

      // í•„í„°ë§ëœ ë°ì´í„°
      const filteredData = useMemo(() => {
        return selectedCategory === 'ì „ì²´' ? rawData : rawData.filter(d => d.category === selectedCategory);
      }, [selectedCategory, rawData]);

      // í†µê³„ ê³„ì‚°
      const stats = useMemo(() => {
        if (filteredData.length === 0) return { totalSpend: 0, totalRevenue: 0, roas: 0, cvr: 0, ctr: 0 };
        
        const totalSpend = filteredData.reduce((acc, curr) => acc + curr.spend, 0);
        const totalRevenue = filteredData.reduce((acc, curr) => acc + curr.revenue, 0);
        
        // ROASëŠ” ì „ì²´ ì˜ˆì‚° ëŒ€ë¹„ ë§¤ì¶œë¡œ ì¬ê³„ì‚°
        const roas = totalSpend > 0 ? (totalRevenue / totalSpend) * 100 : 0;
        // CVR, CTRì€ ì œê³µëœ í¼ì„¼íŠ¸ì˜ ë‹¨ìˆœ í‰ê·  ì²˜ë¦¬
        const cvr = filteredData.reduce((acc, curr) => acc + curr.cvr, 0) / filteredData.length;
        const ctr = filteredData.reduce((acc, curr) => acc + curr.ctr, 0) / filteredData.length;

        return { totalSpend, totalRevenue, roas, cvr, ctr };
      }, [filteredData]);

      // Gemini AI ì§„ë‹¨
      const fetchAIInsights = async () => {
        setIsGenerating(true);
        const apiKey = ""; // ğŸ‘ˆ ì—¬ê¸°ì— ë°œê¸‰ë°›ìœ¼ì‹  Gemini API í‚¤ë¥¼ ë„£ìœ¼ì„¸ìš”!

        const prompt = `
          ë‹¹ì‹ ì€ ë§ˆì¼€íŒ… ë°ì´í„° ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ì„¸ìš”.
          - ë¶„ì„ ì¹´í…Œê³ ë¦¬: ${selectedCategory}
          - ì´ ê´‘ê³ ë¹„: ${stats.totalSpend}ì›
          - ì´ ë§¤ì¶œì•¡: ${stats.totalRevenue}ì›
          - ROAS: ${stats.roas.toFixed(2)}%
          - í‰ê·  CVR: ${stats.cvr.toFixed(2)}%
          
          ê°€ì´ë“œ:
          1. í˜„ì¬ ìˆ˜ì¹˜ì— ëŒ€í•œ ê°ê´€ì  í‰ê°€
          2. ROASì™€ CVR ìˆ˜ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì˜ˆì‚° ìµœì í™” ì œì•ˆ
          3. ì¦‰ê° ì‹¤í–‰ ê°€ëŠ¥í•œ ì•¡ì…˜ í”Œëœ 2ê°€ì§€
        `;

        try {
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              systemInstruction: { parts: [{ text: "ë§ˆì¼€íŒ… ì „ë¬¸ê°€ì˜ í†¤ì•¤ë§¤ë„ˆë¡œ í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”." }] }
            })
          });
          const result = await response.json();
          setAiAnalysis(result.candidates?.[0]?.content?.parts?.[0]?.text);
        } catch (err) {
          setAiAnalysis("AI ë¶„ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        } finally {
          setIsGenerating(false);
        }
      };

      const formatKrw = (val) => new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(val);

      if (isLoading) return <div className="flex h-screen items-center justify-center font-bold text-xl text-blue-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>;
      if (rawData.length === 0) return <div className="flex h-screen items-center justify-center font-bold text-xl text-red-500">data.csv íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</div>;

      return (
        <div className="max-w-7xl mx-auto p-4 md:p-8">
          {/* Header */}
          <div className="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
            <div>
              <h1 className="text-2xl font-black text-slate-900 flex items-center gap-2">
                <span className="text-blue-600"><IconDashboard /></span>
                í†µí•© ê´‘ê³  ì„±ê³¼ ëŒ€ì‹œë³´ë“œ
              </h1>
              <p className="text-slate-500 text-sm font-medium mt-1">CSV ë°ì´í„° ê¸°ë°˜ ìë™í™” ë¦¬í¬íŠ¸</p>
            </div>
            
            {/* Category Filter */}
            <div className="flex bg-white p-1 rounded-2xl shadow-sm border border-slate-200 overflow-x-auto">
              {categories.map(cat => (
                <button
                  key={cat}
                  onClick={() => { setSelectedCategory(cat); setAiAnalysis(null); }}
                  className={`px-4 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${
                    selectedCategory === cat ? 'bg-blue-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'
                  }`}
                >
                  {cat}
                </button>
              ))}
            </div>
          </div>

          {/* Summary Cards */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
              <div className="flex items-center gap-3 mb-3 text-slate-400">
                <IconWallet /> <span className="text-[10px] font-black uppercase">ì´ ê´‘ê³ ë¹„ (Ad Spend)</span>
              </div>
              <div className="text-2xl font-black">{formatKrw(stats.totalSpend)}</div>
            </div>
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
              <div className="flex items-center gap-3 mb-3 text-green-500">
                <IconTrending /> <span className="text-[10px] font-black uppercase">ì´ ë§¤ì¶œì•¡ (Revenue)</span>
              </div>
              <div className="text-2xl font-black text-green-600">{formatKrw(stats.totalRevenue)}</div>
            </div>
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
              <div className="flex items-center gap-3 mb-3 text-blue-500">
                <IconTarget /> <span className="text-[10px] font-black uppercase">í†µí•© ROAS</span>
              </div>
              <div className="text-2xl font-black text-blue-600">{stats.roas.toFixed(1)}%</div>
            </div>
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
              <div className="flex items-center gap-3 mb-3 text-purple-500">
                <IconTarget /> <span className="text-[10px] font-black uppercase">í‰ê·  CVR</span>
              </div>
              <div className="text-2xl font-black text-purple-600">{stats.cvr.toFixed(2)}%</div>
            </div>
          </div>

          {/* AI Analysis */}
          <div className="mb-10">
            {!aiAnalysis ? (
              <div className="bg-gradient-to-br from-indigo-900 to-blue-800 rounded-3xl p-8 text-white shadow-xl text-center">
                <h3 className="text-xl font-black mb-4 flex items-center justify-center gap-2">
                  <span className="text-yellow-300"><IconSparkles /></span> AI í†µí•© ì§„ë‹¨ ë¦¬í¬íŠ¸
                </h3>
                <button onClick={fetchAIInsights} disabled={isGenerating} className="bg-white text-indigo-900 px-8 py-3 rounded-xl font-bold hover:bg-blue-50 transition-all shadow-md disabled:opacity-50">
                  {isGenerating ? 'ë°ì´í„° ë¶„ì„ ì¤‘...' : `${selectedCategory} ì„±ê³¼ ë¶„ì„í•˜ê¸°`}
                </button>
              </div>
            ) : (
              <div className="bg-white border border-slate-200 rounded-3xl overflow-hidden shadow-lg">
                <div className="bg-slate-900 px-6 py-4 text-white font-black flex items-center gap-2">
                  <span className="text-yellow-400"><IconSparkles /></span> {selectedCategory} AI ë¶„ì„ ê²°ê³¼
                </div>
                <div className="p-8 prose prose-slate max-w-none text-slate-700 whitespace-pre-wrap font-medium leading-relaxed">
                  {aiAnalysis}
                </div>
              </div>
            )}
          </div>

          {/* Data Table */}
          <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50">
              <h3 className="font-black text-slate-900 text-sm">ì„¸ë¶€ ë°ì´í„° ({selectedCategory})</h3>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="bg-white text-slate-400 text-left font-bold text-[10px] uppercase border-b border-slate-100">
                  <tr>
                    <th className="px-6 py-4">Category</th>
                    <th className="px-6 py-4 text-right">Ad Spend</th>
                    <th className="px-6 py-4 text-right">Revenue</th>
                    <th className="px-6 py-4 text-right">ROAS</th>
                    <th className="px-6 py-4 text-right">CVR</th>
                    <th className="px-6 py-4 text-right">CTR</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-50">
                  {filteredData.map((row) => (
                    <tr key={row.id} className="hover:bg-slate-50 transition-colors">
                      <td className="px-6 py-4 font-bold text-slate-900">{row.category}</td>
                      <td className="px-6 py-4 text-right font-medium">{formatKrw(row.spend)}</td>
                      <td className="px-6 py-4 text-right font-medium text-green-600">{formatKrw(row.revenue)}</td>
                      <td className="px-6 py-4 text-right font-black text-blue-600">{row.roas.toFixed(2)}%</td>
                      <td className="px-6 py-4 text-right font-bold">{row.cvr.toFixed(2)}%</td>
                      <td className="px-6 py-4 text-right text-slate-500">{row.ctr.toFixed(2)}%</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>