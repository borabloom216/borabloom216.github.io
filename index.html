<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë„¤ì´ë²„ ë³´ë³´ SA ê´‘ê³  ì„±ê³¼ ë¦¬í¬íŠ¸</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif !important;
      font-style: normal !important;
    }
    * { font-style: normal !important; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    const Icons = {
      Wallet: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a8 8 0 0 1-5.45 7.49 2 2 0 0 1-2.31-1.12l-1.56-3.48a2 2 0 0 0-1.82-1.18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h15Z"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      PieChart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>,
      Filter: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
    };

    const getMacroCat = (cat) => {
      if (!cat) return 'ê·¸ ì™¸ ìƒí’ˆ';
      const upperCat = cat.toUpperCase();
      if (upperCat.includes('TV')) return 'TV';
      if (upperCat.includes('ì—ì–´ì»¨')) return 'ì—ì–´ì»¨';
      if (upperCat.includes('ê³µê¸°ì²­ì •ê¸°')) return 'ê³µê¸°ì²­ì •ê¸°'; 
      if (upperCat.includes('ì²­ì†Œê¸°')) return 'ì²­ì†Œê¸°';
      if (upperCat.includes('ì œìŠµê¸°')) return 'ì œìŠµê¸°';
      return 'ê·¸ ì™¸ ìƒí’ˆ';
    };

    const macroCategories = ['TV', 'ì—ì–´ì»¨', 'ê³µê¸°ì²­ì •ê¸°', 'ì²­ì†Œê¸°', 'ì œìŠµê¸°', 'ê·¸ ì™¸ ìƒí’ˆ'];

    const App = () => {
      const [rawData, setRawData] = useState([]);
      const [reportDate, setReportDate] = useState('');
      const [isLoading, setIsLoading] = useState(true);
      const [selectedCategory, setSelectedCategory] = useState('ì „ì²´'); 
      const [pivotCategory, setPivotCategory] = useState('ì „ì²´'); 
      const [loadError, setLoadError] = useState(false);
      
      const [sortConfig, setSortConfig] = useState({ key: 'spend', direction: 'desc' });

      const [budgets, setBudgets] = useState({
        'TV': 20000000, 'ì—ì–´ì»¨': 20000000, 'ê³µê¸°ì²­ì •ê¸°': 10000000, 'ì²­ì†Œê¸°': 20000000, 'ì œìŠµê¸°': 10000000, 'ê·¸ ì™¸ ìƒí’ˆ': 10000000
      });

      const [targetRoas, setTargetRoas] = useState({
        'ì „ì²´': 3000, 'TV': 3000, 'ì—ì–´ì»¨': 3000, 'ê³µê¸°ì²­ì •ê¸°': 3000, 'ì²­ì†Œê¸°': 3000, 'ì œìŠµê¸°': 3000, 'ê·¸ ì™¸ ìƒí’ˆ': 3000
      });
      const [targetCvr, setTargetCvr] = useState({
        'ì „ì²´': 4, 'TV': 4, 'ì—ì–´ì»¨': 4, 'ê³µê¸°ì²­ì •ê¸°': 4, 'ì²­ì†Œê¸°': 4, 'ì œìŠµê¸°': 4, 'ê·¸ ì™¸ ìƒí’ˆ': 4
      });

      const cleanNum = (val) => {
        if (!val) return 0;
        const num = Number(val.toString().replace(/,/g, '').trim());
        return isNaN(num) ? 0 : num;
      };

      useEffect(() => {
        Papa.parse('data.csv', {
          download: true,
          header: true,
          skipEmptyLines: true,
          transformHeader: (header) => header.trim().toLowerCase(),
          complete: (results) => {
            if (results.data.length === 0) {
              setLoadError(true);
              setIsLoading(false);
              return;
            }
            
            if (results.data[0]['date']) {
              setReportDate(results.data[0]['date']);
            }
            
            const parsed = results.data.map((row, idx) => ({
              id: idx,
              category: getMacroCat(row['category'] || ''),
              model: row['model'] || 'ì•Œ ìˆ˜ ì—†ìŒ',
              spend: cleanNum(row['spend'] || row['ad spend']),
              clicks: cleanNum(row['clicks']),
              impressions: cleanNum(row['impressions']),
              conv: cleanNum(row['conv']),
              revenue: cleanNum(row['revenue'])
            }));
            
            setRawData(parsed);
            setIsLoading(false);
          },
          error: (err) => {
            console.error(err);
            setLoadError(true);
            setIsLoading(false);
          }
        });
      }, []);

      const filteredData = useMemo(() => {
        return selectedCategory === 'ì „ì²´' ? rawData : rawData.filter(d => d.category === selectedCategory);
      }, [selectedCategory, rawData]);

      const macroStats = useMemo(() => {
        const stats = { 'ì „ì²´': { spend:0, revenue:0, clicks:0, conv:0 } };
        macroCategories.forEach(mc => stats[mc] = { spend:0, revenue:0, clicks:0, conv:0 });

        rawData.forEach(d => {
            const mc = d.category;
            if (stats[mc]) {
              stats[mc].spend += d.spend;
              stats[mc].revenue += d.revenue;
              stats[mc].clicks += d.clicks;
              stats[mc].conv += d.conv;
            }
            stats['ì „ì²´'].spend += d.spend;
            stats['ì „ì²´'].revenue += d.revenue;
            stats['ì „ì²´'].clicks += d.clicks;
            stats['ì „ì²´'].conv += d.conv;
        });

        Object.keys(stats).forEach(k => {
          stats[k].roas = stats[k].spend > 0 ? (stats[k].revenue / stats[k].spend) * 100 : 0;
          stats[k].cvr = stats[k].clicks > 0 ? (stats[k].conv / stats[k].clicks) * 100 : 0;
        });

        return stats;
      }, [rawData]);

      const totalBudget = useMemo(() => Object.values(budgets).reduce((a, b) => a + b, 0), [budgets]);
      const globalBurnRate = totalBudget > 0 ? (macroStats['ì „ì²´'].spend / totalBudget) * 100 : 0;

      const stats = useMemo(() => {
        const totalSpend = filteredData.reduce((acc, curr) => acc + curr.spend, 0);
        const totalRevenue = filteredData.reduce((acc, curr) => acc + curr.revenue, 0);
        const totalClicks = filteredData.reduce((acc, curr) => acc + curr.clicks, 0);
        const totalConv = filteredData.reduce((acc, curr) => acc + curr.conv, 0);

        return { 
          totalSpend, 
          totalRevenue, 
          totalConv,
          roas: totalSpend > 0 ? (totalRevenue / totalSpend) * 100 : 0,
          cvr: totalClicks > 0 ? (totalConv / totalClicks) * 100 : 0,
        };
      }, [filteredData]);

      const sortedPivotData = useMemo(() => {
        const targetData = pivotCategory === 'ì „ì²´' ? rawData : rawData.filter(item => item.category === pivotCategory);
        const groups = {};
        
        targetData.forEach(item => {
          const key = item.model || 'ë¯¸ìƒ';
          if (!groups[key]) {
            groups[key] = { label: key, spend: 0, revenue: 0, conv: 0, clicks: 0, roas: 0, cvr: 0 };
          }
          groups[key].spend += item.spend;
          groups[key].revenue += item.revenue;
          groups[key].conv += item.conv;
          groups[key].clicks += item.clicks;
        });

        const arrData = Object.values(groups).map(g => {
          g.roas = g.spend > 0 ? (g.revenue / g.spend) * 100 : 0;
          g.cvr = g.clicks > 0 ? (g.conv / g.clicks) * 100 : 0;
          return g;
        });

        arrData.sort((a, b) => {
          if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.direction === 'asc' ? -1 : 1;
          if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });

        return arrData;
      }, [rawData, pivotCategory, sortConfig]);

      const handleSort = (key) => {
        let direction = 'desc';
        if (sortConfig.key === key && sortConfig.direction === 'desc') {
          direction = 'asc';
        }
        setSortConfig({ key, direction });
      };

      const SortIcon = ({ column }) => {
        const isActive = sortConfig.key === column;
        return (
          <span className={`ml-1 inline-block text-[10px] transition-transform ${isActive && sortConfig.direction === 'asc' ? 'rotate-180 text-blue-600' : isActive ? 'text-blue-600' : 'text-slate-300'}`}>
            â–¼
          </span>
        );
      };

      const formatKrw = (val) => `â‚© ${new Intl.NumberFormat('ko-KR').format(val)} ì›`;
      const formatNum = (val) => new Intl.NumberFormat('ko-KR').format(val);

      if (isLoading) return <div className="flex h-screen items-center justify-center font-black text-[24px] text-slate-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>;
      if (loadError) return <div className="flex h-screen items-center justify-center font-black text-[24px] text-red-500">data.csv íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.</div>;

      const currentBudget = selectedCategory === 'ì „ì²´' ? totalBudget : (budgets[selectedCategory] || 0);
      const currentResidual = Math.max(0, currentBudget - stats.totalSpend);
      const currentBurnRatio = currentBudget > 0 ? (stats.totalSpend / currentBudget) * 100 : 0;

      // ì „ì²´ ì¹´í…Œê³ ë¦¬ ë¡œì§ ê³„ì‚° (ROAS)
      const overallRoasDiff = macroStats['ì „ì²´'].roas - (targetRoas['ì „ì²´'] || 1);
      const isOverallRoasAchieved = overallRoasDiff >= 0;
      const overallRoasSign = isOverallRoasAchieved ? '+' : '';
      const overallRoasStatus = isOverallRoasAchieved ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';

      // ì „ì²´ ì¹´í…Œê³ ë¦¬ ë¡œì§ ê³„ì‚° (CVR)
      const overallCvrDiff = macroStats['ì „ì²´'].cvr - (targetCvr['ì „ì²´'] || 1);
      const isOverallCvrAchieved = overallCvrDiff >= 0;
      const overallCvrSign = isOverallCvrAchieved ? '+' : '';
      const overallCvrStatus = isOverallCvrAchieved ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';

      return (
        <div className="min-h-screen bg-slate-50 p-4 md:p-8 text-slate-900">
          <div className="max-w-7xl mx-auto">
            
            {/* Header & Filter */}
            <div className="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
              <div className="flex items-center gap-4">
                {/* ğŸš¨ ë¡œê³  ì´ë¯¸ì§€: íŒŒì¼ëª…ì„ ì‚¬ìš©í•˜ì‹¤ ì´ë¯¸ì§€ íŒŒì¼ëª…(ì˜ˆ: logo.png)ìœ¼ë¡œ ê¼­ ë³€ê²½í•´ ì£¼ì„¸ìš”! */}
                <img 
                  src="logo.png" 
                  alt="ë³´ë³´ ë¡œê³ " 
                  className="h-16 w-auto object-contain" 
                  onError={(e) => { e.target.style.display = 'none'; }} 
                />
                <div>
                  <h1 className="text-[24px] font-black text-slate-900 flex items-center gap-2">
                    ë„¤ì´ë²„ ë³´ë³´ SA ê´‘ê³  ì„±ê³¼ ë¦¬í¬íŠ¸
                  </h1>
                  <p className="text-slate-500 text-[13px] font-bold mt-1">ì‚¼ì„± ê³µì‹ íŒŒíŠ¸ë„ˆ ì£¼ì‹íšŒì‚¬ ë³´ë³´ X ê´‘ê³ ëª…ê°€ ê´‘ê³  ë¦¬í¬íŠ¸</p>
                  {reportDate && <p className="text-slate-500 text-[13px] font-bold mt-1">DATE : {reportDate}</p>}
                </div>
              </div>
              
              <div className="flex bg-white p-1 rounded-2xl shadow-sm border border-slate-200 overflow-x-auto whitespace-nowrap scrollbar-hide">
                {['ì „ì²´', ...macroCategories].map(cat => (
                  <button
                    key={cat}
                    onClick={() => setSelectedCategory(cat)}
                    className={`px-4 py-2 rounded-xl text-[14px] font-bold transition-all ${
                      selectedCategory === cat ? 'bg-blue-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'
                    }`}
                  >
                    {cat}
                  </button>
                ))}
              </div>
            </div>

            {/* 1. ì¢…í•© ì˜ˆì‚° ì†Œì§„ ë¹„ìœ¨ */}
            <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8">
              <div className="px-6 py-5 border-b border-slate-100 flex items-center justify-between">
                <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                  <span className="text-slate-600"><Icons.Wallet /></span> ì¢…í•© ì˜ˆì‚° ì†Œì§„ ë¹„ìœ¨
                </h3>
              </div>
              <div className="p-8">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  
                  {/* ì „ì²´ ì†Œì§„ìœ¨ ì¹´ë“œ */}
                  <div className="bg-slate-900 rounded-2xl p-6 text-white col-span-1">
                    <div className="flex justify-between items-start mb-6">
                      <div>
                        <p className="text-[14px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Burn Rate</p>
                        <h4 className="text-[24px] font-black">ì „ì²´ í†µí•© ì˜ˆì‚°</h4>
                      </div>
                      <div className="text-[24px] font-black text-blue-400">{globalBurnRate.toFixed(1)}%</div>
                    </div>
                    <div className="h-2 bg-white/10 rounded-full overflow-hidden mb-4">
                      <div className="h-full bg-blue-400" style={{ width: `${Math.min(globalBurnRate, 100)}%` }} />
                    </div>
                    <div className="flex flex-col gap-2 text-[14px] font-bold text-slate-300 mt-2">
                      <span>ì†Œì§„ ê´‘ê³ ë¹„: {formatKrw(macroStats['ì „ì²´'].spend)}</span>
                      <span>ì˜ˆì‚°: {formatKrw(totalBudget)}</span>
                    </div>
                  </div>

                  {/* ì¹´í…Œê³ ë¦¬ë³„ ê°œë³„ ì˜ˆì‚° ì…ë ¥ */}
                  <div className="col-span-1 lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {macroCategories.map(mc => {
                      const spend = macroStats[mc].spend;
                      const budget = budgets[mc] || 0;
                      const ratio = budget > 0 ? (spend / budget) * 100 : 0;

                      return (
                        <div key={mc} className="p-4 border border-slate-200 rounded-2xl bg-white hover:border-blue-300 transition-colors shadow-sm">
                          <div className="flex justify-between items-center mb-3">
                            <span className="text-[14px] font-black text-slate-900">{mc}</span>
                            <span className="text-[14px] font-bold text-slate-500">ì†Œì§„ ë¹„ìœ¨ {ratio.toFixed(1)}%</span>
                          </div>
                          <div className="flex items-center gap-2 bg-slate-50 px-2 py-1.5 rounded-lg border border-slate-200 w-full mb-3">
                            <span className="text-[12px] font-bold text-slate-400">ì˜ˆì‚°</span>
                            <input
                              type="number"
                              value={budgets[mc]}
                              onChange={(e) => setBudgets({...budgets, [mc]: Number(e.target.value)})}
                              className="flex-1 w-full bg-transparent text-right text-[14px] font-bold text-slate-700 focus:outline-none"
                            />
                            <span className="text-[12px] font-bold text-slate-400">ì›</span>
                          </div>
                          <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div className="h-full bg-slate-800" style={{ width: `${Math.min(ratio, 100)}%` }} />
                          </div>
                          <div className="mt-3 text-[14px] text-slate-500 font-bold">ì†Œì§„ ê´‘ê³ ë¹„: {formatKrw(spend)}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>

            {/* 2. Top 4 KPI Summary */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-[#d4a000]">
                  <Icons.Wallet />
                  <span className="text-[18px] font-black">ì†Œì§„ ê´‘ê³ ë¹„</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatKrw(stats.totalSpend)}</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">
                  {selectedCategory === 'ì „ì²´' ? 'ì „ì²´ ê³„ì • ì´ ì†Œì§„ ê´‘ê³ ë¹„' : `${selectedCategory} ì¹´í…Œê³ ë¦¬ ì†Œì§„ ê´‘ê³ ë¹„`}
                </div>
              </div>
              
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-green-600">
                  <Icons.TrendingUp />
                  <span className="text-[18px] font-black">ë§¤ì¶œ ì„±ê³¼ (ROAS)</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatKrw(stats.totalRevenue)}</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">ROAS {stats.roas.toFixed(0)}%</div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-blue-600">
                  <Icons.Target />
                  <span className="text-[18px] font-black">ì „í™˜ ì„±ê³¼ (CVR)</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatNum(stats.totalConv)}ê±´</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">CVR {stats.cvr.toFixed(2)}%</div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-purple-600">
                  <Icons.PieChart />
                  <span className="text-[18px] font-black">ì”ì—¬ ì˜ˆì‚°</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatKrw(currentResidual)}</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">
                  ì†Œì§„ ë¹„ìœ¨ : {currentBurnRatio.toFixed(1)}%
                </div>
              </div>
            </div>

            {/* 3. ì¹´í…Œê³ ë¦¬ë³„ ëª©í‘œ ë‹¬ì„± í˜„í™© (ROAS & CVR) */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
              
              {/* ROAS ëª©í‘œ ë‹¬ì„± í˜„í™© */}
              <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50">
                  <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                    <span className="text-green-600"><Icons.TrendingUp /></span> ì¹´í…Œê³ ë¦¬ë³„ ëª©í‘œ ROAS ë‹¬ì„± í˜„í™©
                  </h3>
                </div>
                <div className="p-8 space-y-6">
                  
                  {/* ì „ì²´ ì¹´í…Œê³ ë¦¬ í†µí•© ROAS */}
                  <div className="p-5 bg-slate-50 rounded-xl border border-slate-200 mb-6">
                    <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-3 mb-3">
                      <div className="flex items-center gap-2">
                        <span className="text-[14px] font-black text-slate-900">ì „ì²´ ì¹´í…Œê³ ë¦¬ í†µí•©</span>
                        <span className="text-[12px] font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded whitespace-nowrap">í˜„ì¬ : {macroStats['ì „ì²´'].roas.toFixed(0)} %</span>
                      </div>
                      <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                        <div className="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                          <span className="text-[12px] font-bold text-slate-500">ëª©í‘œì„¤ì •</span>
                          <input type="number" value={targetRoas['ì „ì²´']} onChange={(e)=>setTargetRoas({...targetRoas, 'ì „ì²´': Number(e.target.value)})} className="w-16 text-right font-bold text-[13px] text-slate-800 focus:outline-none" />
                          <span className="text-[12px] font-bold text-slate-500">%</span>
                        </div>
                        <span className={`text-[13px] font-bold whitespace-nowrap ${isOverallRoasAchieved ? 'text-indigo-600' : 'text-red-500'}`}>
                          ëª©í‘œ ROAS {overallRoasSign}{overallRoasDiff.toFixed(0)}% {overallRoasStatus}
                        </span>
                      </div>
                    </div>
                    <div className="h-3 bg-slate-200 rounded-full overflow-hidden">
                      <div className={`h-full rounded-full ${isOverallRoasAchieved ? 'bg-indigo-600' : 'bg-red-500'} transition-all duration-500`} style={{ width: `${Math.min((macroStats['ì „ì²´'].roas / (targetRoas['ì „ì²´'] || 1)) * 100, 100)}%` }} />
                    </div>
                  </div>

                  {/* ê°œë³„ ì¹´í…Œê³ ë¦¬ ROAS */}
                  {macroCategories.map((mc) => {
                    const diff = macroStats[mc].roas - (targetRoas[mc] || 1);
                    const isAchieved = diff >= 0;
                    const sign = isAchieved ? '+' : '';
                    const statusText = isAchieved ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';

                    return (
                      <div key={mc} className="space-y-2 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                        <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-2">
                          <div className="flex items-center gap-2 min-w-[140px]">
                            <span className="text-[14px] font-bold text-slate-900">{mc}</span>
                            <span className="text-[12px] font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded whitespace-nowrap">í˜„ì¬ : {macroStats[mc].roas.toFixed(0)} %</span>
                          </div>
                          
                          {/* ìˆ˜ë™ ì…ë ¥ì¹¸ê³¼ ë‹¬ì„± í…ìŠ¤íŠ¸ë¥¼ í•œ ì¤„ë¡œ(ì¢Œì¸¡ ë•¡ê¹€) */}
                          <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                            <div className="flex items-center gap-1">
                              <span className="text-[12px] font-bold text-slate-400">ëª©í‘œ</span>
                              <input type="number" value={targetRoas[mc]} onChange={(e)=>setTargetRoas({...targetRoas, [mc]: Number(e.target.value)})} className="w-14 border-b border-slate-200 bg-transparent text-right font-bold text-[13px] focus:outline-none focus:border-green-500" />
                              <span className="text-[12px] font-bold text-slate-400">%</span>
                            </div>
                            <span className={`text-[13px] font-bold whitespace-nowrap ${isAchieved ? "text-green-600" : "text-red-500"}`}>
                              ëª©í‘œ ROAS {sign}{diff.toFixed(0)}% {statusText}
                            </span>
                          </div>
                        </div>
                        <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${isAchieved ? 'bg-green-500' : 'bg-red-400'} transition-all duration-500`} style={{ width: `${Math.min((macroStats[mc].roas / (targetRoas[mc] || 1)) * 100, 100)}%` }} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* CVR ëª©í‘œ ë‹¬ì„± í˜„í™© */}
              <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50">
                  <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                    <span className="text-blue-600"><Icons.Target /></span> ì¹´í…Œê³ ë¦¬ë³„ ëª©í‘œ ì „í™˜ìœ¨ (CVR) ë‹¬ì„± í˜„í™©
                  </h3>
                </div>
                <div className="p-8 space-y-6">
                  
                  {/* ì „ì²´ ì¹´í…Œê³ ë¦¬ í†µí•© CVR */}
                  <div className="p-5 bg-slate-50 rounded-xl border border-slate-200 mb-6">
                    <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-3 mb-3">
                      <div className="flex items-center gap-2">
                        <span className="text-[14px] font-black text-slate-900">ì „ì²´ ì¹´í…Œê³ ë¦¬ í†µí•©</span>
                        <span className="text-[12px] font-bold text-purple-600 bg-purple-50 px-2 py-0.5 rounded whitespace-nowrap">í˜„ì¬ : {macroStats['ì „ì²´'].cvr.toFixed(2)} %</span>
                      </div>
                      <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                        <div className="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                          <span className="text-[12px] font-bold text-slate-500">ëª©í‘œì„¤ì •</span>
                          <input type="number" step="0.1" value={targetCvr['ì „ì²´']} onChange={(e)=>setTargetCvr({...targetCvr, 'ì „ì²´': Number(e.target.value)})} className="w-16 text-right font-bold text-[13px] text-slate-800 focus:outline-none" />
                          <span className="text-[12px] font-bold text-slate-500">%</span>
                        </div>
                        <span className={`text-[13px] font-bold whitespace-nowrap ${isOverallCvrAchieved ? 'text-purple-600' : 'text-red-500'}`}>
                          ëª©í‘œ CVR {overallCvrSign}{overallCvrDiff.toFixed(2)}% {overallCvrStatus}
                        </span>
                      </div>
                    </div>
                    <div className="h-3 bg-slate-200 rounded-full overflow-hidden">
                      <div className={`h-full rounded-full ${isOverallCvrAchieved ? 'bg-purple-600' : 'bg-red-500'} transition-all duration-500`} style={{ width: `${Math.min((macroStats['ì „ì²´'].cvr / (targetCvr['ì „ì²´'] || 1)) * 100, 100)}%` }} />
                    </div>
                  </div>

                  {/* ê°œë³„ ì¹´í…Œê³ ë¦¬ CVR */}
                  {macroCategories.map((mc) => {
                    const diff = macroStats[mc].cvr - (targetCvr[mc] || 1);
                    const isAchieved = diff >= 0;
                    const sign = isAchieved ? '+' : '';
                    const statusText = isAchieved ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';

                    return (
                      <div key={mc} className="space-y-2 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                        <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-2">
                          <div className="flex items-center gap-2 min-w-[140px]">
                            <span className="text-[14px] font-bold text-slate-900">{mc}</span>
                            <span className="text-[12px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded whitespace-nowrap">í˜„ì¬ : {macroStats[mc].cvr.toFixed(2)} %</span>
                          </div>
                          
                          <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                            <div className="flex items-center gap-1">
                              <span className="text-[12px] font-bold text-slate-400">ëª©í‘œ</span>
                              <input type="number" step="0.1" value={targetCvr[mc]} onChange={(e)=>setTargetCvr({...targetCvr, [mc]: Number(e.target.value)})} className="w-14 border-b border-slate-200 bg-transparent text-right font-bold text-[13px] focus:outline-none focus:border-blue-500" />
                              <span className="text-[11px] font-bold text-slate-400">%</span>
                            </div>
                            <span className={`text-[13px] font-bold whitespace-nowrap ${isAchieved ? "text-blue-600" : "text-red-500"}`}>
                              ëª©í‘œ CVR {sign}{diff.toFixed(2)}% {statusText}
                            </span>
                          </div>
                        </div>
                        <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${isAchieved ? 'bg-blue-500' : 'bg-red-400'} transition-all duration-500`} style={{ width: `${Math.min((macroStats[mc].cvr / (targetCvr[mc] || 1)) * 100, 100)}%` }} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>

            {/* 4. ì„¸ë¶€ ì„±ê³¼ í•­ëª© (Modelë³„ ë°ì´í„° í”¼ë²— & í…Œì´ë¸” ì •ë ¬) */}
            <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8">
              <div className="px-8 py-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                  <span className="text-blue-600"><Icons.Filter /></span> ì„¸ë¶€ ì„±ê³¼ í•­ëª©
                </h3>
                <div className="flex bg-slate-100 p-1 rounded-xl overflow-x-auto whitespace-nowrap scrollbar-hide">
                  {['ì „ì²´', ...macroCategories].map(cat => (
                    <button 
                      key={cat}
                      onClick={() => setPivotCategory(cat)} 
                      className={`px-4 py-2 text-[14px] font-bold rounded-lg transition-all ${pivotCategory === cat ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500 hover:bg-white/50'}`}
                    >
                      {cat}
                    </button>
                  ))}
                </div>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full text-[14px]">
                  <thead className="bg-slate-50 text-slate-500 text-left font-bold text-[14px] border-b border-slate-200">
                    <tr>
                      <th className="px-8 py-5">ë¶„ì„ í•­ëª©</th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('spend')}>
                        ê´‘ê³ ë¹„ <SortIcon column="spend" />
                      </th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('revenue')}>
                        ê´‘ê³ ë§¤ì¶œ <SortIcon column="revenue" />
                      </th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('roas')}>
                        ROAS <SortIcon column="roas" />
                      </th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('conv')}>
                        íŒë§¤ìˆ˜ëŸ‰ <SortIcon column="conv" />
                      </th>
                      <th className="px-8 py-5 text-right text-blue-600 cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('cvr')}>
                        ì „í™˜ ì„±ê³¼ (CVR) <SortIcon column="cvr" />
                      </th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-50">
                    {sortedPivotData.length > 0 ? sortedPivotData.map((row, idx) => (
                      <tr key={idx} className="hover:bg-slate-50/50 transition-colors">
                        <td className="px-8 py-5 font-black text-slate-900">{row.label}</td>
                        <td className="px-8 py-5 text-right font-bold">{formatKrw(row.spend)}</td>
                        <td className="px-8 py-5 text-right font-black">{formatKrw(row.revenue)}</td>
                        <td className="px-8 py-5 text-right text-green-600 font-black">{row.roas.toFixed(0)}%</td>
                        <td className="px-8 py-5 text-right font-bold">{formatNum(row.conv)}ê±´</td>
                        <td className="px-8 py-5 text-right font-black text-blue-600">{row.cvr.toFixed(2)}%</td>
                      </tr>
                    )) : (
                      <tr><td colSpan="6" className="text-center py-10 text-slate-400 font-bold">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>