<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>네이버 검색광고 성과 인텔리전스</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    /* 스크롤바 숨김 처리 */
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .animate-spin-slow { animation: spin 2s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // 아이콘(SVG) 컴포넌트 모음 (단일 파일을 위해 내장)
    const Icons = {
      LayoutDashboard: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
      Wallet: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a8 8 0 0 1-5.45 7.49 2 2 0 0 1-2.31-1.12l-1.56-3.48a2 2 0 0 0-1.82-1.18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h15Z"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
      Target: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      PieChart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>,
      Sparkles: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
      Filter: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
      Loader2: () => <svg className="animate-spin-slow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
      RefreshCw: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
    };

    const App = () => {
      const [rawData, setRawData] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [selectedCategory, setSelectedCategory] = useState('전체');
      const [pivotBy, setPivotBy] = useState('campaignType');
      const [aiAnalysis, setAiAnalysis] = useState(null);
      const [isGenerating, setIsGenerating] = useState(false);
      const [loadError, setLoadError] = useState(false);

      // 목표 KPI 및 월간 예산 설정
      const config = {
        'TV': { targetROAS: 1000, targetCVR: 1.2, budget: 15000000 },
        '에어컨': { targetROAS: 800, targetCVR: 2.5, budget: 20000000 },
        '청소기': { targetROAS: 600, targetCVR: 2.2, budget: 10000000 },
        '공기청정기': { targetROAS: 500, targetCVR: 1.8, budget: 5000000 },
        '제습기': { targetROAS: 700, targetCVR: 2.0, budget: 6000000 },
        'MD(그 외)': { targetROAS: 350, targetCVR: 2.1, budget: 3000000 },
      };

      // 텍스트/콤마가 섞인 숫자를 순수 숫자로 변환하는 방어 로직
      const cleanNum = (val) => {
        if (!val) return 0;
        const num = Number(val.toString().replace(/,/g, '').trim());
        return isNaN(num) ? 0 : num;
      };

      // CSV 파일 불러오기
      useEffect(() => {
        Papa.parse('data.csv', {
          download: true,
          header: true,
          skipEmptyLines: true,
          // 헤더의 공백 무시 및 소문자 변환으로 안정성 강화
          transformHeader: (header) => header.trim().toLowerCase(),
          complete: (results) => {
            if (results.data.length === 0) {
              setLoadError(true);
              setIsLoading(false);
              return;
            }
            const parsed = results.data.map((row, idx) => ({
              id: idx,
              category: row['category'] || '미분류',
              campaign: row['campaign'] || '',
              campaignType: row['campaigntype'] || row['type'] || '기타', // type으로 썼을 경우도 대비
              device: row['device'] || '기타',
              spend: cleanNum(row['spend']),
              clicks: cleanNum(row['clicks']),
              impressions: cleanNum(row['impressions']),
              conv: cleanNum(row['conv']),
              revenue: cleanNum(row['revenue'])
            }));
            setRawData(parsed);
            setIsLoading(false);
          },
          error: (err) => {
            console.error("CSV 데이터를 읽을 수 없습니다:", err);
            setLoadError(true);
            setIsLoading(false);
          }
        });
      }, []);

      // 전체 요약 통계 계산
      const totalStats = useMemo(() => {
        const totalSpend = rawData.reduce((a, b) => a + b.spend, 0);
        const totalRevenue = rawData.reduce((a, b) => a + b.revenue, 0);
        const totalClicks = rawData.reduce((a, b) => a + b.clicks, 0);
        const totalConv = rawData.reduce((a, b) => a + b.conv, 0);
        const totalBudget = Object.values(config).reduce((a, b) => a + b.budget, 0);

        return {
          spend: totalSpend,
          revenue: totalRevenue,
          roas: totalSpend > 0 ? (totalRevenue / totalSpend) * 100 : 0,
          cvr: totalClicks > 0 ? (totalConv / totalClicks) * 100 : 0,
          budget: totalBudget,
          burnRate: totalBudget > 0 ? (totalSpend / totalBudget) * 100 : 0
        };
      }, [rawData]);

      // 필터링된 데이터
      const filteredData = useMemo(() => {
        return selectedCategory === '전체' ? rawData : rawData.filter(d => d.category === selectedCategory);
      }, [selectedCategory, rawData]);

      // 선택된 카테고리 통계
      const stats = useMemo(() => {
        const totalSpend = filteredData.reduce((acc, curr) => acc + curr.spend, 0);
        const totalRevenue = filteredData.reduce((acc, curr) => acc + curr.revenue, 0);
        const totalClicks = filteredData.reduce((acc, curr) => acc + curr.clicks, 0);
        const totalConv = filteredData.reduce((acc, curr) => acc + curr.conv, 0);

        return { 
          totalSpend, 
          totalRevenue, 
          totalConv,
          roas: totalSpend > 0 ? (totalRevenue / totalSpend) * 100 : 0,
          cvr: totalClicks > 0 ? (totalConv / totalClicks) * 100 : 0,
        };
      }, [filteredData]);

      // 피벗 테이블 데이터 계산
      const pivotData = useMemo(() => {
        const groups = {};
        filteredData.forEach(item => {
          const key = item[pivotBy] || '기타';
          if (!groups[key]) {
            groups[key] = { label: key, spend: 0, revenue: 0, conv: 0, clicks: 0 };
          }
          groups[key].spend += item.spend;
          groups[key].revenue += item.revenue;
          groups[key].conv += item.conv;
          groups[key].clicks += item.clicks;
        });
        return Object.values(groups).sort((a, b) => b.spend - a.spend); // 광고비 순 정렬
      }, [filteredData, pivotBy]);

      // Gemini AI 리포트 생성
      const fetchAIInsights = async () => {
        setIsGenerating(true);
        // ⭐ 아래 따옴표 안에 발급받으신 Gemini API 키를 넣어주세요.
        const apiKey = "AIzaSyCcyQTL_IVlN8i6W2Dp5DEg_H9buY_ddtM"; 

        const currentBudget = selectedCategory === '전체' ? totalStats.budget : (config[selectedCategory]?.budget || 0);
        const burnRate = currentBudget > 0 ? (stats.totalSpend / currentBudget) * 100 : 0;

        const prompt = `
          당신은 가전 브랜드 마케팅 분석 전문가입니다.
          아래의 검색광고 원본 데이터를 분석하여 마케팅 전략을 제안하세요:
          - 선택 카테고리: ${selectedCategory}
          - ROAS: ${stats.roas.toFixed(2)}%
          - 구매전환율(CVR): ${stats.cvr.toFixed(2)}%
          - 광고비 소진율: ${burnRate.toFixed(1)}%
          
          작성 가이드:
          1. ROAS와 CVR 달성도를 기반으로 한 현재 성과 총평
          2. 예산 소진 속도에 따른 입찰 전략 제언
          3. 성과 개선을 위한 3가지 구체적인 액션 아이템
        `;

        try {
          // gemini-2.5-flash 모델 적용 (더 빠르고 안정적)
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              systemInstruction: { parts: [{ text: "전문적인 마케팅 분석 리포트 형식으로 작성하세요." }] }
            })
          });
          const result = await response.json();
          if (result.error) throw new Error(result.error.message);
          setAiAnalysis(result.candidates?.[0]?.content?.parts?.[0]?.text);
        } catch (err) {
          console.error(err);
          setAiAnalysis("AI 분석 리포트를 생성하는 중 오류가 발생했습니다. (API 키를 코드에 입력했는지 확인해 주세요!)");
        } finally {
          setIsGenerating(false);
        }
      };

      const formatKrw = (val) => new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(val);
      const formatNum = (val) => new Intl.NumberFormat('ko-KR').format(val);

      // 로딩 및 에러 화면
      if (isLoading) return <div className="flex h-screen items-center justify-center font-black text-2xl text-slate-400 gap-2"><Icons.Loader2 /> 데이터를 불러오는 중입니다...</div>;
      if (loadError) return <div className="flex h-screen items-center justify-center font-black text-2xl text-red-500">data.csv 파일을 찾을 수 없거나 데이터 구조에 문제가 있습니다.</div>;

      return (
        <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-800">
          <div className="max-w-7xl mx-auto">
            
            {/* 1. Header & Filter */}
            <div className="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
              <div>
                <h1 className="text-2xl font-black text-slate-900 flex items-center gap-2">
                  <span className="text-blue-600"><Icons.LayoutDashboard /></span>
                  네이버 검색광고 성과 인텔리전스 ✨
                </h1>
                <p className="text-slate-500 text-sm font-medium mt-1">브랜드 가전 품목별 예산 및 성과 통합 리포트 (CSV 연동형)</p>
              </div>
              
              <div className="flex bg-white p-1 rounded-2xl shadow-sm border border-slate-200 overflow-x-auto whitespace-nowrap scrollbar-hide">
                {['전체', ...Object.keys(config)].map(cat => (
                  <button
                    key={cat}
                    onClick={() => { setSelectedCategory(cat); setAiAnalysis(null); }}
                    className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${
                      selectedCategory === cat ? 'bg-blue-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'
                    }`}
                  >
                    {cat}
                  </button>
                ))}
              </div>
            </div>

            {/* 2. Total Summary Row */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-3 mb-3 text-slate-400">
                  <Icons.Wallet />
                  <span className="text-[10px] font-black uppercase tracking-widest">누적 광고 소진액</span>
                </div>
                <div className="text-2xl font-black">{formatKrw(stats.totalSpend)}</div>
                <div className="mt-2 text-[10px] text-slate-400 font-bold">
                  전체 예산의 {((stats.totalSpend / (selectedCategory === '전체' ? totalStats.budget : (config[selectedCategory]?.budget || 1))) * 100).toFixed(1)}% 소진
                </div>
              </div>
              
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-3 mb-3 text-green-500">
                  <Icons.TrendingUp />
                  <span className="text-[10px] font-black uppercase tracking-widest">매출 성과 (ROAS)</span>
                </div>
                <div className="text-2xl font-black text-green-600">{formatKrw(stats.totalRevenue)}</div>
                <div className="mt-1 text-sm font-black text-green-500">{stats.roas.toFixed(0)}%</div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-3 mb-3 text-blue-500">
                  <Icons.Target />
                  <span className="text-[10px] font-black uppercase tracking-widest">전환 성과 (CVR)</span>
                </div>
                <div className="text-2xl font-black">{formatNum(stats.totalConv)}건</div>
                <div className="mt-1 text-sm font-black text-blue-500">{stats.cvr.toFixed(2)}%</div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-3 mb-3 text-purple-500">
                  <Icons.PieChart />
                  <span className="text-[10px] font-black uppercase tracking-widest">잔여 예산</span>
                </div>
                <div className="text-2xl font-black">
                  {formatKrw((selectedCategory === '전체' ? totalStats.budget : (config[selectedCategory]?.budget || 0)) - stats.totalSpend)}
                </div>
                <div className="mt-1 text-[10px] font-bold text-slate-400 uppercase">Monthly Budget Control</div>
              </div>
            </div>

            {/* 3. KPI 달성 현황 섹션 (ROAS & CVR) */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
              {/* ROAS 달성도 */}
              <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                  <h3 className="font-black text-slate-900 text-sm flex items-center gap-2">
                    <span className="text-green-600"><Icons.TrendingUp /></span> 카테고리별 ROAS 달성 현황
                  </h3>
                  <div className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Target vs Actual</div>
                </div>
                <div className="p-8 space-y-6">
                  {Object.entries(config).map(([cat, cfg]) => {
                    const catData = rawData.filter(d => d.category === cat);
                    const spend = catData.reduce((a, b) => a + b.spend, 0);
                    const rev = catData.reduce((a, b) => a + b.revenue, 0);
                    const actual = spend > 0 ? (rev / spend) * 100 : 0;
                    const progress = Math.min((actual / cfg.targetROAS) * 100, 100);
                    return (
                      <div key={cat} className="space-y-1.5">
                        <div className="flex justify-between text-[11px] font-bold">
                          <span className="text-slate-800">{cat}</span>
                          <span className={progress >= 90 ? 'text-green-600' : 'text-slate-500'}>{actual.toFixed(0)}% / {cfg.targetROAS}%</span>
                        </div>
                        <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${progress >= 90 ? 'bg-green-500' : progress >= 70 ? 'bg-yellow-500' : 'bg-red-400'}`} style={{ width: `${progress}%` }} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* CVR 달성도 */}
              <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                  <h3 className="font-black text-slate-900 text-sm flex items-center gap-2">
                    <span className="text-blue-600"><Icons.Target /></span> 카테고리별 전환율(CVR) 달성 현황
                  </h3>
                  <div className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Target vs Actual</div>
                </div>
                <div className="p-8 space-y-6">
                  {Object.entries(config).map(([cat, cfg]) => {
                    const catData = rawData.filter(d => d.category === cat);
                    const clicks = catData.reduce((a, b) => a + b.clicks, 0);
                    const conv = catData.reduce((a, b) => a + b.conv, 0);
                    const actual = clicks > 0 ? (conv / clicks) * 100 : 0;
                    const progress = Math.min((actual / cfg.targetCVR) * 100, 100);
                    return (
                      <div key={cat} className="space-y-1.5">
                        <div className="flex justify-between text-[11px] font-bold">
                          <span className="text-slate-800">{cat}</span>
                          <span className={progress >= 90 ? 'text-blue-600' : 'text-slate-500'}>{actual.toFixed(2)}% / {cfg.targetCVR}%</span>
                        </div>
                        <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${progress >= 90 ? 'bg-blue-500' : progress >= 70 ? 'bg-indigo-400' : 'bg-slate-300'}`} style={{ width: `${progress}%` }} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>

            {/* 4. 예산 및 소진율 분석 섹션 */}
            <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8">
              <div className="px-8 py-5 border-b border-slate-100 flex items-center justify-between">
                <h3 className="font-black text-slate-900 text-sm flex items-center gap-2">
                  <span className="text-slate-600"><Icons.Wallet /></span> 월간 허용 예산 및 소진율 분석 (Burn Rate)
                </h3>
              </div>
              <div className="p-8">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  <div className="bg-slate-900 rounded-2xl p-6 text-white col-span-1">
                    <div className="flex justify-between items-start mb-4">
                      <div>
                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Account Burn Rate</p>
                        <h4 className="text-xl font-black italic">전체 통합 예산</h4>
                      </div>
                      <div className="text-2xl font-black text-blue-400">{totalStats.burnRate.toFixed(1)}%</div>
                    </div>
                    <div className="h-2 bg-white/10 rounded-full overflow-hidden mb-4">
                      <div className="h-full bg-blue-400" style={{ width: `${Math.min(totalStats.burnRate, 100)}%` }} />
                    </div>
                    <div className="flex justify-between text-[11px] font-medium text-slate-300">
                      <span>소진: {formatKrw(totalStats.spend)}</span>
                      <span>총 예산: {formatKrw(totalStats.budget)}</span>
                    </div>
                  </div>

                  <div className="col-span-1 lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {Object.entries(config).map(([cat, cfg]) => {
                      const spend = rawData.filter(d => d.category === cat).reduce((a, b) => a + b.spend, 0);
                      const burnRate = (spend / cfg.budget) * 100;
                      return (
                        <div key={cat} className="p-4 border border-slate-100 rounded-2xl hover:bg-slate-50 transition-colors">
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs font-black text-slate-800">{cat}</span>
                            <span className={`text-xs font-black ${burnRate >= 90 ? 'text-red-500' : 'text-slate-500'}`}>{burnRate.toFixed(1)}%</span>
                          </div>
                          <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div className={`h-full ${burnRate >= 90 ? 'bg-red-500' : 'bg-slate-900'}`} style={{ width: `${Math.min(burnRate, 100)}%` }} />
                          </div>
                          <div className="mt-2 text-[10px] text-slate-400 font-bold">집행: {formatKrw(spend)} / {formatKrw(cfg.budget)}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>

            {/* 5. AI Insight Section */}
            <div className="mb-10">
              {!aiAnalysis ? (
                <div className="bg-gradient-to-br from-indigo-900 via-blue-800 to-indigo-900 rounded-3xl p-10 text-white shadow-xl text-center">
                  <div className="mx-auto text-yellow-300 mb-6 flex justify-center"><Icons.Sparkles /></div>
                  <h3 className="text-2xl font-black mb-2">예산 소진 및 성과 지표 기반 AI 진단</h3>
                  <p className="text-blue-100 mb-8 max-w-lg mx-auto font-medium">현재 {selectedCategory}의 ROAS/CVR 달성도와 예산 소진 속도를 분석하여 최적화 전략을 도출합니다.</p>
                  <button 
                    onClick={fetchAIInsights}
                    disabled={isGenerating}
                    className="bg-white text-indigo-900 px-10 py-4 rounded-2xl font-black hover:bg-blue-50 transition-all shadow-lg flex items-center justify-center gap-3 mx-auto disabled:opacity-50"
                  >
                    {isGenerating ? <span className="text-indigo-900"><Icons.Loader2 /></span> : <span className="text-indigo-900"><Icons.Sparkles /></span>}
                    {isGenerating ? '데이터 분석 리포트 생성 중...' : 'Gemini AI 통합 전략 리포트 생성'}
                  </button>
                </div>
              ) : (
                <div className="bg-white border border-slate-200 rounded-3xl overflow-hidden shadow-xl">
                  <div className="bg-slate-900 px-8 py-5 flex items-center justify-between text-white">
                    <div className="flex items-center gap-3 font-black text-lg">
                      <span className="text-yellow-400"><Icons.Sparkles /></span> AI 분석 리포트: {selectedCategory} 성과 및 예산 진단
                    </div>
                    <button onClick={fetchAIInsights} className="p-2 hover:bg-slate-800 rounded-full transition-colors">
                      <Icons.RefreshCw />
                    </button>
                  </div>
                  <div className="p-10 prose prose-slate max-w-none text-slate-700 leading-8 whitespace-pre-wrap font-medium">
                    {aiAnalysis}
                  </div>
                </div>
              )}
            </div>

            {/* 6. Pivot Table */}
            <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8">
              <div className="px-8 py-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <h3 className="font-black text-slate-900 text-sm flex items-center gap-2 uppercase tracking-tight">
                  <span className="text-blue-600"><Icons.Filter /></span> 세부 성과 데이터 피벗 ({selectedCategory})
                </h3>
                <div className="flex bg-slate-100 p-1 rounded-xl">
                  <button onClick={() => setPivotBy('campaignType')} className={`px-4 py-2 text-xs font-black rounded-lg transition-all ${pivotBy === 'campaignType' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}>광고유형</button>
                  <button onClick={() => setPivotBy('device')} className={`px-4 py-2 text-xs font-black rounded-lg transition-all ${pivotBy === 'device' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}>디바이스</button>
                </div>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead className="bg-slate-50 text-slate-400 text-left font-bold text-[10px] uppercase tracking-widest border-b border-slate-200">
                    <tr>
                      <th className="px-8 py-5">분석 기준 ({pivotBy === 'campaignType' ? '유형' : '기기'})</th>
                      <th className="px-8 py-5 text-right">광고비</th>
                      <th className="px-8 py-5 text-right">매출액</th>
                      <th className="px-8 py-5 text-right">ROAS</th>
                      <th className="px-8 py-5 text-right">전환수</th>
                      <th className="px-8 py-5 text-right text-blue-600">구매전환율</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-50">
                    {pivotData.length > 0 ? pivotData.map((row, idx) => (
                      <tr key={idx} className="hover:bg-slate-50/50 transition-colors">
                        <td className="px-8 py-5 font-black text-slate-900">{row.label}</td>
                        <td className="px-8 py-5 text-right font-medium">{formatKrw(row.spend)}</td>
                        <td className="px-8 py-5 text-right font-black">{formatKrw(row.revenue)}</td>
                        <td className="px-8 py-5 text-right text-green-600 font-black">{row.spend > 0 ? ((row.revenue / row.spend) * 100).toFixed(0) : 0}%</td>
                        <td className="px-8 py-5 text-right font-medium">{formatNum(row.conv)}건</td>
                        <td className="px-8 py-5 text-right font-black text-blue-600">{row.clicks > 0 ? ((row.conv / row.clicks) * 100).toFixed(2) : 0}%</td>
                      </tr>
                    )) : (
                      <tr><td colSpan="6" className="text-center py-10 text-slate-400 font-bold">해당 카테고리에 데이터가 없습니다.</td></tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>