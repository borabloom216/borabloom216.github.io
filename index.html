<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>네이버 보보 SA 광고 성과 리포트</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: 'Malgun Gothic', '맑은 고딕', sans-serif !important;
      font-style: normal !important;
    }
    * { font-style: normal !important; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    const Icons = {
      Wallet: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a8 8 0 0 1-5.45 7.49 2 2 0 0 1-2.31-1.12l-1.56-3.48a2 2 0 0 0-1.82-1.18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h15Z"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      PieChart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>,
      Filter: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
    };

    const getMacroCat = (cat) => {
      if (!cat) return '그 외 상품';
      const upperCat = cat.toUpperCase();
      if (upperCat.includes('TV')) return 'TV';
      if (upperCat.includes('에어컨')) return '에어컨';
      if (upperCat.includes('공기청정기')) return '공기청정기'; 
      if (upperCat.includes('청소기')) return '청소기';
      if (upperCat.includes('제습기')) return '제습기';
      return '그 외 상품';
    };

    const macroCategories = ['TV', '에어컨', '공기청정기', '청소기', '제습기', '그 외 상품'];

    const App = () => {
      const [rawData, setRawData] = useState([]);
      const [reportDate, setReportDate] = useState('');
      const [isLoading, setIsLoading] = useState(true);
      const [selectedCategory, setSelectedCategory] = useState('전체'); 
      const [pivotCategory, setPivotCategory] = useState('전체'); 
      const [loadError, setLoadError] = useState(false);
      
      const [sortConfig, setSortConfig] = useState({ key: 'spend', direction: 'desc' });

      const [budgets, setBudgets] = useState({
        'TV': 20000000, '에어컨': 20000000, '공기청정기': 10000000, '청소기': 20000000, '제습기': 10000000, '그 외 상품': 10000000
      });

      const [targetRoas, setTargetRoas] = useState({
        '전체': 3000, 'TV': 3000, '에어컨': 3000, '공기청정기': 3000, '청소기': 3000, '제습기': 3000, '그 외 상품': 3000
      });
      const [targetCvr, setTargetCvr] = useState({
        '전체': 4, 'TV': 4, '에어컨': 4, '공기청정기': 4, '청소기': 4, '제습기': 4, '그 외 상품': 4
      });

      const cleanNum = (val) => {
        if (!val) return 0;
        const num = Number(val.toString().replace(/,/g, '').trim());
        return isNaN(num) ? 0 : num;
      };

      useEffect(() => {
        Papa.parse('data.csv', {
          download: true,
          header: true,
          skipEmptyLines: true,
          transformHeader: (header) => header.trim().toLowerCase(),
          complete: (results) => {
            if (results.data.length === 0) {
              setLoadError(true);
              setIsLoading(false);
              return;
            }
            
            if (results.data[0] && results.data[0]['date']) {
              setReportDate(results.data[0]['date']);
            }
            
            const parsed = results.data.map((row, idx) => ({
              id: idx,
              category: getMacroCat(row['category'] || ''),
              model: row['model'] || '알 수 없음',
              spend: cleanNum(row['spend'] || row['ad spend']),
              clicks: cleanNum(row['clicks']),
              impressions: cleanNum(row['impressions']),
              conv: cleanNum(row['conv']),
              revenue: cleanNum(row['revenue'])
            }));
            
            setRawData(parsed);
            setIsLoading(false);
          },
          error: (err) => {
            console.error(err);
            setLoadError(true);
            setIsLoading(false);
          }
        });
      }, []);

      const filteredData = useMemo(() => {
        return selectedCategory === '전체' ? rawData : rawData.filter(d => d.category === selectedCategory);
      }, [selectedCategory, rawData]);

      const macroStats = useMemo(() => {
        const stats = { '전체': { spend:0, revenue:0, clicks:0, conv:0 } };
        macroCategories.forEach(mc => stats[mc] = { spend:0, revenue:0, clicks:0, conv:0 });

        rawData.forEach(d => {
            const mc = d.category;
            if (stats[mc]) {
              stats[mc].spend += d.spend;
              stats[mc].revenue += d.revenue;
              stats[mc].clicks += d.clicks;
              stats[mc].conv += d.conv;
            }
            stats['전체'].spend += d.spend;
            stats['전체'].revenue += d.revenue;
            stats['전체'].clicks += d.clicks;
            stats['전체'].conv += d.conv;
        });

        Object.keys(stats).forEach(k => {
          stats[k].roas = stats[k].spend > 0 ? (stats[k].revenue / stats[k].spend) * 100 : 0;
          stats[k].cvr = stats[k].clicks > 0 ? (stats[k].conv / stats[k].clicks) * 100 : 0;
        });

        return stats;
      }, [rawData]);

      const totalBudget = useMemo(() => Object.values(budgets).reduce((a, b) => a + b, 0), [budgets]);
      const globalBurnRate = totalBudget > 0 ? (macroStats['전체'].spend / totalBudget) * 100 : 0;

      const stats = useMemo(() => {
        const totalSpend = filteredData.reduce((acc, curr) => acc + curr.spend, 0);
        const totalRevenue = filteredData.reduce((acc, curr) => acc + curr.revenue, 0);
        const totalClicks = filteredData.reduce((acc, curr) => acc + curr.clicks, 0);
        const totalConv = filteredData.reduce((acc, curr) => acc + curr.conv, 0);

        return { 
          totalSpend, 
          totalRevenue, 
          totalConv,
          roas: totalSpend > 0 ? (totalRevenue / totalSpend) * 100 : 0,
          cvr: totalClicks > 0 ? (totalConv / totalClicks) * 100 : 0,
        };
      }, [filteredData]);

      const sortedPivotData = useMemo(() => {
        const targetData = pivotCategory === '전체' ? rawData : rawData.filter(item => item.category === pivotCategory);
        const groups = {};
        
        targetData.forEach(item => {
          const key = item.model || '미상';
          if (!groups[key]) {
            groups[key] = { label: key, spend: 0, revenue: 0, conv: 0, clicks: 0, roas: 0, cvr: 0 };
          }
          groups[key].spend += item.spend;
          groups[key].revenue += item.revenue;
          groups[key].conv += item.conv;
          groups[key].clicks += item.clicks;
        });

        const arrData = Object.values(groups).map(g => {
          g.roas = g.spend > 0 ? (g.revenue / g.spend) * 100 : 0;
          g.cvr = g.clicks > 0 ? (g.conv / g.clicks) * 100 : 0;
          return g;
        });

        arrData.sort((a, b) => {
          if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.direction === 'asc' ? -1 : 1;
          if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });

        return arrData;
      }, [rawData, pivotCategory, sortConfig]);

      const handleSort = (key) => {
        let direction = 'desc';
        if (sortConfig.key === key && sortConfig.direction === 'desc') {
          direction = 'asc';
        }
        setSortConfig({ key, direction });
      };

      const SortIcon = ({ column }) => {
        const isActive = sortConfig.key === column;
        return (
          <span className={`ml-1 inline-block text-[10px] transition-transform ${isActive && sortConfig.direction === 'asc' ? 'rotate-180 text-blue-600' : isActive ? 'text-blue-600' : 'text-slate-300'}`}>
            ▼
          </span>
        );
      };

      const formatKrw = (val) => `₩ ${new Intl.NumberFormat('ko-KR').format(val)} 원`;
      const formatNum = (val) => new Intl.NumberFormat('ko-KR').format(val);

      if (isLoading) return <div className="flex h-screen items-center justify-center font-black text-[24px] text-slate-400">데이터를 불러오는 중입니다...</div>;
      if (loadError) return <div className="flex h-screen items-center justify-center font-black text-[24px] text-red-500">data.csv 파일을 찾을 수 없거나 형식이 잘못되었습니다.</div>;

      const currentBudget = selectedCategory === '전체' ? totalBudget : (budgets[selectedCategory] || 0);
      const currentResidual = Math.max(0, currentBudget - stats.totalSpend);
      const currentBurnRatio = currentBudget > 0 ? (stats.totalSpend / currentBudget) * 100 : 0;

      const overallRoasDiff = macroStats['전체'].roas - (targetRoas['전체'] || 1);
      const isOverallRoasAchieved = overallRoasDiff >= 0;
      const overallRoasSign = isOverallRoasAchieved ? '+' : '';
      const overallRoasStatus = isOverallRoasAchieved ? '달성' : '미달성';

      const overallCvrDiff = macroStats['전체'].cvr - (targetCvr['전체'] || 1);
      const isOverallCvrAchieved = overallCvrDiff >= 0;
      const overallCvrSign = isOverallCvrAchieved ? '+' : '';
      const overallCvrStatus = isOverallCvrAchieved ? '달성' : '미달성';

      return (
        <div className="min-h-screen bg-slate-50 p-4 md:p-8 text-slate-900">
          <div className="max-w-7xl mx-auto">
            
            <div className="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
              <div className="flex items-center gap-4">
                <img 
                  src="LOGO.jpg" 
                  alt="보보 로고" 
                  className="h-16 w-auto object-contain" 
                  onError={(e) => { e.target.style.display = 'none'; }} 
                />
                <div>
                  <h1 className="text-[24px] font-black text-slate-900 flex items-center gap-2">
                    네이버 보보 SA 광고 성과 리포트
                  </h1>
                  <p className="text-slate-500 text-[13px] font-bold mt-1">삼성 공식 파트너 주식회사 보보 X 광고명가 광고 리포트</p>
                  {reportDate && <p className="text-slate-500 text-[13px] font-bold mt-1">DATE : {reportDate}</p>}
                </div>
              </div>
              
              <div className="flex bg-white p-1 rounded-2xl shadow-sm border border-slate-200 overflow-x-auto whitespace-nowrap scrollbar-hide">
                {['전체', ...macroCategories].map(cat => (
                  <button
                    key={cat}
                    onClick={() => setSelectedCategory(cat)}
                    className={`px-4 py-2 rounded-xl text-[14px] font-bold transition-all ${
                      selectedCategory === cat ? 'bg-blue-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'
                    }`}
                  >
                    {cat}
                  </button>
                ))}
              </div>
            </div>

            <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8">
              <div className="px-6 py-5 border-b border-slate-100 flex items-center justify-between">
                <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                  <span className="text-slate-600"><Icons.Wallet /></span> 종합 예산 소진 비율
                </h3>
              </div>
              <div className="p-8">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  
                  <div className="bg-slate-900 rounded-2xl p-6 text-white col-span-1">
                    <div className="flex justify-between items-start mb-6">
                      <div>
                        <p className="text-[14px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Burn Rate</p>
                        <h4 className="text-[24px] font-black">전체 통합 예산</h4>
                      </div>
                      <div className="text-[24px] font-black text-blue-400">{globalBurnRate.toFixed(1)}%</div>
                    </div>
                    <div className="h-2 bg-white/10 rounded-full overflow-hidden mb-4">
                      <div className="h-full bg-blue-400" style={{ width: `${Math.min(globalBurnRate, 100)}%` }} />
                    </div>
                    <div className="flex flex-col gap-2 text-[14px] font-bold text-slate-300 mt-2">
                      <span>소진 광고비: {formatKrw(macroStats['전체'].spend)}</span>
                      <span>예산: {formatKrw(totalBudget)}</span>
                    </div>
                  </div>

                  <div className="col-span-1 lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {macroCategories.map(mc => {
                      const spend = macroStats[mc].spend;
                      const budget = budgets[mc] || 0;
                      const ratio = budget > 0 ? (spend / budget) * 100 : 0;

                      return (
                        <div key={mc} className="p-4 border border-slate-200 rounded-2xl bg-white hover:border-blue-300 transition-colors shadow-sm">
                          <div className="flex justify-between items-center mb-3">
                            <span className="text-[14px] font-black text-slate-900">{mc}</span>
                            <span className="text-[14px] font-bold text-slate-500">소진 비율 {ratio.toFixed(1)}%</span>
                          </div>
                          <div className="flex items-center gap-2 bg-slate-50 px-2 py-1.5 rounded-lg border border-slate-200 w-full mb-3">
                            <span className="text-[12px] font-bold text-slate-400">예산</span>
                            <input
                              type="number"
                              value={budgets[mc]}
                              onChange={(e) => setBudgets({...budgets, [mc]: Number(e.target.value)})}
                              className="flex-1 w-full bg-transparent text-right text-[14px] font-bold text-slate-700 focus:outline-none"
                            />
                            <span className="text-[12px] font-bold text-slate-400">원</span>
                          </div>
                          <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div className="h-full bg-slate-800" style={{ width: `${Math.min(ratio, 100)}%` }} />
                          </div>
                          <div className="mt-3 text-[14px] text-slate-500 font-bold">소진 광고비: {formatKrw(spend)}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-[#d4a000]">
                  <Icons.Wallet />
                  <span className="text-[18px] font-black">소진 광고비</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatKrw(stats.totalSpend)}</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">
                  {selectedCategory === '전체' ? '전체 계정 총 소진 광고비' : `${selectedCategory} 카테고리 소진 광고비`}
                </div>
              </div>
              
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-green-600">
                  <Icons.TrendingUp />
                  <span className="text-[18px] font-black">매출 성과 (ROAS)</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatKrw(stats.totalRevenue)}</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">ROAS {stats.roas.toFixed(0)}%</div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-blue-600">
                  <Icons.Target />
                  <span className="text-[18px] font-black">전환 성과 (CVR)</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatNum(stats.totalConv)}건</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">CVR {stats.cvr.toFixed(2)}%</div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-2 mb-3 text-purple-600">
                  <Icons.PieChart />
                  <span className="text-[18px] font-black">잔여 예산</span>
                </div>
                <div className="text-[24px] font-black text-slate-900">{formatKrw(currentResidual)}</div>
                <div className="mt-2 text-[13px] text-slate-500 font-bold">
                  소진 비율 : {currentBurnRatio.toFixed(1)}%
                </div>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
              
              <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50">
                  <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                    <span className="text-green-600"><Icons.TrendingUp /></span> 카테고리별 목표 ROAS 달성 현황
                  </h3>
                </div>
                <div className="p-8 space-y-6">
                  
                  <div className="p-5 bg-slate-50 rounded-xl border border-slate-200 mb-6">
                    <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-3 mb-3">
                      <div className="flex items-center gap-2">
                        <span className="text-[14px] font-black text-slate-900">전체 카테고리 통합</span>
                        <span className="text-[12px] font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded whitespace-nowrap">현재 : {macroStats['전체'].roas.toFixed(0)} %</span>
                      </div>
                      <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                        <div className="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                          <span className="text-[13px] font-bold text-slate-500">목표설정</span>
                          <input type="number" value={targetRoas['전체']} onChange={(e)=>setTargetRoas({...targetRoas, '전체': Number(e.target.value)})} className="w-16 text-right font-bold text-[13px] text-slate-800 focus:outline-none" />
                          <span className="text-[12px] font-bold text-slate-500">%</span>
                        </div>
                        <span className={`text-[13px] font-bold whitespace-nowrap ${isOverallRoasAchieved ? 'text-indigo-600' : 'text-red-500'}`}>
                          목표 ROAS {overallRoasSign}{overallRoasDiff.toFixed(0)}% {overallRoasStatus}
                        </span>
                      </div>
                    </div>
                    <div className="h-3 bg-slate-200 rounded-full overflow-hidden">
                      <div className={`h-full rounded-full ${isOverallRoasAchieved ? 'bg-indigo-600' : 'bg-red-500'} transition-all duration-500`} style={{ width: `${Math.min((macroStats['전체'].roas / (targetRoas['전체'] || 1)) * 100, 100)}%` }} />
                    </div>
                  </div>

                  {macroCategories.map((mc) => {
                    const diff = macroStats[mc].roas - (targetRoas[mc] || 1);
                    const isAchieved = diff >= 0;
                    const sign = isAchieved ? '+' : '';
                    const statusText = isAchieved ? '달성' : '미달성';

                    return (
                      <div key={mc} className="space-y-2 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                        <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-2">
                          <div className="flex items-center gap-2 min-w-[140px]">
                            <span className="text-[14px] font-bold text-slate-900">{mc}</span>
                            <span className="text-[12px] font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded whitespace-nowrap">현재 : {macroStats[mc].roas.toFixed(0)} %</span>
                          </div>
                          
                          <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                            <div className="flex items-center gap-1">
                              <span className="text-[13px] font-bold text-slate-400">목표</span>
                              <input type="number" value={targetRoas[mc]} onChange={(e)=>setTargetRoas({...targetRoas, [mc]: Number(e.target.value)})} className="w-14 border-b border-slate-200 bg-transparent text-right font-bold text-[13px] focus:outline-none focus:border-green-500" />
                              <span className="text-[12px] font-bold text-slate-400">%</span>
                            </div>
                            <span className={`text-[13px] font-bold whitespace-nowrap ${isAchieved ? "text-green-600" : "text-red-500"}`}>
                              목표 ROAS {sign}{diff.toFixed(0)}% {statusText}
                            </span>
                          </div>
                        </div>
                        <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${isAchieved ? 'bg-green-500' : 'bg-red-400'} transition-all duration-500`} style={{ width: `${Math.min((macroStats[mc].roas / (targetRoas[mc] || 1)) * 100, 100)}%` }} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-5 border-b border-slate-100 bg-slate-50/50">
                  <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                    <span className="text-blue-600"><Icons.Target /></span> 카테고리별 목표 전환율 (CVR) 달성 현황
                  </h3>
                </div>
                <div className="p-8 space-y-6">
                  
                  <div className="p-5 bg-slate-50 rounded-xl border border-slate-200 mb-6">
                    <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-3 mb-3">
                      <div className="flex items-center gap-2">
                        <span className="text-[14px] font-black text-slate-900">전체 카테고리 통합</span>
                        <span className="text-[12px] font-bold text-purple-600 bg-purple-50 px-2 py-0.5 rounded whitespace-nowrap">현재 : {macroStats['전체'].cvr.toFixed(2)} %</span>
                      </div>
                      <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                        <div className="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                          <span className="text-[13px] font-bold text-slate-500">목표설정</span>
                          <input type="number" step="0.1" value={targetCvr['전체']} onChange={(e)=>setTargetCvr({...targetCvr, '전체': Number(e.target.value)})} className="w-16 text-right font-bold text-[13px] text-slate-800 focus:outline-none" />
                          <span className="text-[12px] font-bold text-slate-500">%</span>
                        </div>
                        <span className={`text-[13px] font-bold whitespace-nowrap ${isOverallCvrAchieved ? 'text-purple-600' : 'text-red-500'}`}>
                          목표 CVR {overallCvrSign}{overallCvrDiff.toFixed(2)}% {overallCvrStatus}
                        </span>
                      </div>
                    </div>
                    <div className="h-3 bg-slate-200 rounded-full overflow-hidden">
                      <div className={`h-full rounded-full ${isOverallCvrAchieved ? 'bg-purple-600' : 'bg-red-500'} transition-all duration-500`} style={{ width: `${Math.min((macroStats['전체'].cvr / (targetCvr['전체'] || 1)) * 100, 100)}%` }} />
                    </div>
                  </div>

                  {macroCategories.map((mc) => {
                    const diff = macroStats[mc].cvr - (targetCvr[mc] || 1);
                    const isAchieved = diff >= 0;
                    const sign = isAchieved ? '+' : '';
                    const statusText = isAchieved ? '달성' : '미달성';

                    return (
                      <div key={mc} className="space-y-2 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                        <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-2">
                          <div className="flex items-center gap-2 min-w-[140px]">
                            <span className="text-[14px] font-bold text-slate-900">{mc}</span>
                            <span className="text-[12px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded whitespace-nowrap">현재 : {macroStats[mc].cvr.toFixed(2)} %</span>
                          </div>
                          
                          <div className="flex items-center justify-start sm:justify-end gap-3 flex-1">
                            <div className="flex items-center gap-1">
                              <span className="text-[13px] font-bold text-slate-400">목표</span>
                              <input type="number" step="0.1" value={targetCvr[mc]} onChange={(e)=>setTargetCvr({...targetCvr, [mc]: Number(e.target.value)})} className="w-14 border-b border-slate-200 bg-transparent text-right font-bold text-[13px] focus:outline-none focus:border-blue-500" />
                              <span className="text-[11px] font-bold text-slate-400">%</span>
                            </div>
                            <span className={`text-[13px] font-bold whitespace-nowrap ${isAchieved ? "text-blue-600" : "text-red-500"}`}>
                              목표 CVR {sign}{diff.toFixed(2)}% {statusText}
                            </span>
                          </div>
                        </div>
                        <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${isAchieved ? 'bg-blue-500' : 'bg-red-400'} transition-all duration-500`} style={{ width: `${Math.min((macroStats[mc].cvr / (targetCvr[mc] || 1)) * 100, 100)}%` }} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>

            <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8">
              <div className="px-8 py-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <h3 className="font-black text-slate-900 text-[18px] flex items-center gap-2">
                  <span className="text-blue-600"><Icons.Filter /></span> 세부 성과 항목
                </h3>
                <div className="flex bg-slate-100 p-1 rounded-xl overflow-x-auto whitespace-nowrap scrollbar-hide">
                  {['전체', ...macroCategories].map(cat => (
                    <button 
                      key={cat}
                      onClick={() => setPivotCategory(cat)} 
                      className={`px-4 py-2 text-[14px] font-bold rounded-lg transition-all ${pivotCategory === cat ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500 hover:bg-white/50'}`}
                    >
                      {cat}
                    </button>
                  ))}
                </div>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full text-[14px]">
                  <thead className="bg-slate-50 text-slate-500 text-left font-bold text-[14px] border-b border-slate-200">
                    <tr>
                      <th className="px-8 py-5">분석 항목</th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('spend')}>
                        광고비 <SortIcon column="spend" />
                      </th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('revenue')}>
                        광고매출 <SortIcon column="revenue" />
                      </th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('roas')}>
                        ROAS <SortIcon column="roas" />
                      </th>
                      <th className="px-8 py-5 text-right cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('conv')}>
                        판매수량 <SortIcon column="conv" />
                      </th>
                      <th className="px-8 py-5 text-right text-blue-600 cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => handleSort('cvr')}>
                        전환 성과 (CVR) <SortIcon column="cvr" />
                      </th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-50">
                    {sortedPivotData.length > 0 ? sortedPivotData.map((row, idx) => (
                      <tr key={idx} className="hover:bg-slate-50/50 transition-colors">
                        <td className="px-8 py-5 font-black text-slate-900">{row.label}</td>
                        <td className="px-8 py-5 text-right font-bold">{formatKrw(row.spend)}</td>
                        <td className="px-8 py-5 text-right font-black">{formatKrw(row.revenue)}</td>
                        <td className="px-8 py-5 text-right text-green-600 font-black">{row.roas.toFixed(0)}%</td>
                        <td className="px-8 py-5 text-right font-bold">{formatNum(row.conv)}건</td>
                        <td className="px-8 py-5 text-right font-black text-blue-600">{row.cvr.toFixed(2)}%</td>
                      </tr>
                    )) : (
                      <tr><td colSpan="6" className="text-center py-10 text-slate-400 font-bold">해당 카테고리에 데이터가 없습니다.</td></tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>